<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chat Example</title>
    <script src="parser.js"></script>
    <script type="text/javascript">
      window.onload = function () {
        var cacheTable = []; //this is a really, REALLY basic caching table, that tells the renderer when converting addresses from log to regular, what to skip over by value
        var conn;

        msg = document.getElementById("rawsource"); //the raw, markdown source
        log = document.getElementById("log"); //the visible source to the user
        // Made the two above into global variables because who cares

        // function cursorUpdated(selectionStart,selectionEnd) {
        //     if (!conn) {
        //         return false;
        //     }
        //     conn.send([selectionStart,selectionEnd]);
        //     return false;
        // }
        function checkCached(address) {
          //checks the character location to see if it's cached
          for (let i = 0; i < cacheTable.length; i += 2) {
            if (cacheTable[i] === address) {
              return true;
            }
          }
          return false;
        }
        
        // document.getElementById("form").onsubmit = function () {
        //     if (!conn) {
        //         return false;
        //     }
        //     if (!msg.value) {
        //         return false;
        //     }
        //     conn.send(msg.value);
        //     msg.value = "";
        //     return false;
        // };
        log.addEventListener("keydown", (e) => {
          render();
          // const selection = window.getSelection();
          // let ranges = [];

          // for (let i = 0; i < selection.rangeCount; i++) {
          //     selecteditem = selection.getRangeAt(i);
          //     console.log(selecteditem.commonAncestorContainer.nodeName);
          // }
          // const range = selection.getRangeAt(0);
          // console.log(getPosition(e.target));
          // // Check if the selection contains a span
          // // if (range.commonAncestorContainer.tagName.toLowerCase() === 'span') {
          //     // Expand the selection to include the entire span
          //     // range.setStartBefore(range.commonAncestorContainer);
          //     // range.setEndAfter(range.commonAncestorContainer);
          //     // selection.removeAllRanges();
          //     // selection.addRange(range);
          // // }

          // // Process the normalized selection (e.g., get the selected text, apply formatting)
          // const selectedText = selection.toString();
          // console.log(selectedText);
          // // cursorUpdated(selRange.startOffset,selRange.startOffset)
        });
        log.addEventListener("mouseup", (e) => {
          // cursorUpdated(e.target.selectionStart,e.target.selectionEnd)
        });
        // if (window["WebSocket"]) {
        //     conn = new WebSocket("ws://" + document.location.host + "/ws");
        //     conn.onclose = function (evt) {
        //     };
        //     conn.onmessage = function (evt) {
        //         var messages = evt.data;
        //         console.log(messages)
        //     };
        // } else {
        //     var item = document.createElement("div");
        //     item.innerHTML = "<b>Your browser does not support WebSockets.</b>";
        //     appendLog(item);
        // }
      };
    </script>
    <style type="text/css">
      html {
        overflow: hidden;
      }

      body {
        overflow: hidden;
        padding: 0;
        margin: 0;
        width: 100%;
        height: 100%;
        background: gray;
      }

      #log {
        background: white;
        margin: 0;
        padding: 0.5em 0.5em 0.5em 0.5em;
        position: absolute;
        top: 0.5em;
        left: 0.5em;
        right: 0.5em;
        bottom: 3em;
        overflow: auto;
        resize: none;
      }

      #form {
        padding: 0 0.5em 0 0.5em;
        margin: 0;
        position: absolute;
        bottom: 1em;
        left: 0px;
        width: 100%;
        overflow: hidden;
      }
    </style>
  </head>
  <body>
    <div id="rawsource" style="white-space: pre">
      Hello **world**!
      *this is a test, so see if **mixed stuff** works, if at all...*
      How about ***bold and italic*** together?
      **this is a *sentence* that tests a few things**
      \*\*\*this shouldnt be bold\*\*\*
      **what if we give it **dumb stupid code** that shouldnt work?**\*
      If you want to draw a textbox, you can do it **like this**
      [!] Checked! \[!\]
      [ ] Unchecked \[ \]

      But hey, what if you want a link?
      [DOWNLOAD MORE RAM \(FREE\)\!\!\!](https://example.com)
      href
      Woooooooah dude, howd you do that????
      Oh, it's actually pretty easy:
      \[DOWNLOAD MORE RAM \\(FREE\\\)\\!\\!\\!\]\(https://example.com\)
      ![The MacOS 10.5 Default wallpaper](10-5.png)
      x^2^ or x~2~ i dont ~~understand either way~~ but hey, __thats **OKAY**__
      <!-- I *think* that this code is working, but **IM NOT SURE.** -->
    </div>
    <div id="log" contenteditable="true"></div>
  </body>
</html>
